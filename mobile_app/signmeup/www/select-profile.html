<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>SignMeUp</title>
		<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
		<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="css/global.css" media="screen">
		<link rel="stylesheet" type="text/css" href="css/style.css" media="screen">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
	</head>
	<body>
		<!--Page Wrapper Start-->
		<div id="wrapper"  class="qr-code">

			<!--Header Section Start-->
			<header id="header">
				<h2>Select Profile</h2>
				<a href="javascript:history.go(-1)" class="edit-btn back-btn"><img src="img/back-icon.png" alt="back" /></a>
			</header>
			<!--Header Section End-->

			<!--Content Area Start-->
			<div id="content">
				<!-- <ul class="profile-select">
					<li class="private">
						<span>&nbsp;</span>
						<a href="#">
							<strong>Private</strong>
							<em>some short description</em>
							<i>&nbsp;</i>
						</a>
					</li>
					<li class="public">
						<span>&nbsp;</span>
						<a href="#">
							<strong>Public</strong>
							<em>description about the profile above</em>
							<i>&nbsp;</i>
						</a>
					</li>
					<li class="business">
						<span>&nbsp;</span>
						<a href="#">
							<strong>Business</strong>
							<em>some short description</em>
							<i>&nbsp;</i>
						</a>
					</li>
				</ul> -->
			</div>
			<!--Content Area End-->

			<!--Footer Section Start-->
			<footer id="footer" class="bottom-btn">
				<!-- <input type="submit" value="ADD NEW PROFILE"><i class="add">&nbsp;</i></input> -->
				<a href="add-profile.html">ADD NEW PROFILE</a>
			</footer>
			<!--Footer Section End-->

		</div>
		<!--Page Wrapper End-->
		<script type="text/javascript" src="js/site.js"></script>
		<script type="text/javascript">
			
     // $(document).on('deviceready', function() {
     // 	console.log("navigator", navigator);
   	 //   window.new_alert = window.navigator.notification.alert;
     //  });

			// function nope() {};

			alert('Scan succeeded! Select which profile you want to send')
       // var profiles = null;		
       
       // alert('tp1');
       current_user = localStorage.getItem('current_user');
       // profiles = localStorage.getItem('profiles');
       var server = 'http://signmeup.gg' ; //'http://192.168.4.47:3001'
       var profiles = null;
       var params = {};
       params.access_token = localStorage.getItem('access_token');
		   //$(document).ready(function() {
		  $( function () { 	
	      	$.ajax({
	      		url: server + '/api/v1/users/' + current_user + '/profiles',
	      		data: params,
	      		method: 'GET',
	      		dataType: 'JSON',
	      		success: function(resp) {
	      			console.log('resp:',resp );
	      			profiles = resp.profiles;
	      			// if (resp.result == 'success') {
                var ctx =  '<ul class="profile-select">';
								for (i=0; i < profiles.length; i++) {
                    ctx += 		'<li class="private"><span>&nbsp;</span><a href="#" onclick="sendProfile(' + i + ')" id="profile_' + resp.profiles[i].id ;
                    ctx += '"><strong>' + resp.profiles[i].profile_name + '</strong>';
                    var desc = '<span><strong>Name:</strong>' + resp.profiles[i].name + '&nbsp;&nbsp;</span>';
                    desc +=  '<span><strong>Surname:</strong>' + resp.profiles[i].surname + '&nbsp;&nbsp;</span>';
										desc += '<span><strong>Email:</strong>' + resp.profiles[i].email + '&nbsp;&nbsp;</span>';
										desc += '<span><strong>Country:</strong>' + resp.profiles[i].country_id + '&nbsp;&nbsp;</span>';
										desc += '<span><strong>Date of Birth:</strong>' + resp.profiles[i].date_of_birth + '&nbsp;&nbsp;</span>';
                    ctx += desc + '</a></li>';
										ctx += '<ul class="profile-select" id="profile_'+ resp.profiles[i].id +'">';	
								}
								ctx += '</ul>';
								$('#content').append(ctx);
	      			// }
	      			// url = localStorage.getItem('callback_url');
  					},
	      		error: function(error,xhr,status) { console.log('result:',error);}
	  			})    


		   });

       function sendProfile(idx) {
       	  var url = localStorage.getItem('callback_url');
  				console.log('url:',url);
       		// var params = $('#content form').serialize();
			   	// var profile_id = this.id.replace('profile_','');
			   	var profile_id = profiles[idx].id;
			   	var params = {access_token: localStorage.getItem('access_token'), id: profile_id, callback_url: url};
		      $.ajax({
	      		url: server + '/api/v1/users/' + current_user + '/profiles/send_profile?' + $.param(params),
	      		//data: ,
	      		method: 'POST',
	      		dataType: 'JSON',
	      		success: function(resp) {
	      			// resp.profile_url
	      			if (resp.result == 'success') {
	      				var site = url.split('/')[1];
	      				alert('Successfully registered to ' + site +  ' site with email ' + resp.email);
            //     window.new_alert(
					       // 	'Successfully registered to ' + site +  ' site with email ' + resp.email , nope , 'Sign Up succeeded', 'OK'
					       // );
		          }
		          else {
		          	alert('Errors occured: ' +resp.errors );
		          // 	window.new_alert(
					       // 	resp.errors , nope , 'Errors occured: ', 'OK'
					       // );
		          }

	      		}
				  })
		    }
			
		</script>
		
	</body>
</html>